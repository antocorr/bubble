{
  "version": 3,
  "sources": ["../src/lib/Signals.js", "../src/lib/Reactivity.js"],
  "sourcesContent": ["let current;\nexport function createSignal(initialValue) {\n    let value = initialValue;\n    const\n        subscribers = [];\n    function refresh() {\n        subscribers.forEach(sub => sub())\n    }\n    function\n        set(newValue) {\n        value = newValue;\n        refresh();\n    }\n    function read() {\n        if (current) {            \n            subscribers.push(current)\n        }\n        return value;\n    }\n    return [read, set, refresh]\n}\nexport function effect(fn) {\n    current = fn;\n    fn();\n    current = null;\n}\nclass SignalObject{\n    read;\n    set;\n    refresh;\n    constructor(value){\n        const [read, set, refresh] = createSignal(value);\n        this.read = read;\n        this.set = set;\n        this.refresh = refresh;\n    }\n    get value(){\n        return this.read();\n    }\n    set value(newValue){\n        this.set(newValue);\n    }\n    push(newValue){\n        this.value.push(new SignalObject(newValue));\n        this.refresh();\n    }\n}\nexport function Signal(value){\n    return new SignalObject(value);\n}", "import { effect, Signal } from \"./Signals.js\";\n/**\n * \n * @param {string} markup \n * @returns {HTMLElement}\n */\nexport function html(markup) {\n    const tp = document.createElement('template');\n    tp.innerHTML = markup.trim();\n    return tp.content.firstElementChild;\n}\nconst styleTagsAdded = [];\nfunction bubblify(str) {\n    //replace all @click with -bb-onclick\n    str = str.replace(/@click/g, '-x-onclick');\n    return str;\n}\nfunction prepareForReplace(txt) {\n    /**\n     * @type {string[]}\n     */\n    const textArr = txt.split('{{');\n    const reactiveIndexes = [];\n    for (let i = 0; i < textArr.length; i++) {\n        if (textArr[i].includes('}}')) {\n            const parts = textArr[i].split('}}');\n            textArr[i] = parts[0];\n            //add second part to the array\n            textArr.splice(i + 1, 0, parts[1]);\n            reactiveIndexes.push(i);\n        }\n    }\n    console.log(textArr, reactiveIndexes);\n    return [textArr, reactiveIndexes];\n}\n/**\n * \n * @param {{}} component \n * @param {HTMLElement} child \n * @param {string[]} textArr \n * @param {number[]} reactiveIndexes \n */\nfunction replace(component, child, textArr, reactiveIndexes, moreData = {}) {\n    let newText = '';\n    const data = { ...component._data, ...moreData };\n    if (Object.keys(moreData).length) {\n        console.log('moreData', moreData);\n    }\n    for (let i = 0; i < textArr.length; i++) {        \n        if (reactiveIndexes.includes(i)) {\n            const key = textArr[i];\n            if (data && data[key]) {\n                newText += data[key].value;\n            } else {\n                console.error(`Key ${key} not found in data`);\n            }\n        } else {\n            newText += textArr[i];\n        }\n    }\n    child.textContent = newText;\n}\n/**\n * \n * @param {{}} original \n * @param {{} | undefined} data \n * @returns {{\n * $element: HTMLElement,\n * appendTo: (parent: HTMLElement) => void,\n * refs: {Object.<string, HTMLElement>},\n * _data: {Object.<string, SignalObject>},\n * }}\n */\nexport function createComponent(original, data) {\n    const component = {\n        $element: null,\n        appendTo: (parent) => {\n            if (component.$element) {\n                parent.appendChild(component.$element);\n                if(component.mounted){\n                    component.mounted();\n                }\n            }\n        },\n        refs: {}, ...original, ...data\n    };\n    let tp = component.setTemplate ? component.setTemplate : component.template;\n    if (typeof tp == \"function\") {\n        tp = tp();\n    }\n    if (tp) {\n        component.$element = html(bubblify(tp));\n    }\n    if (component.$element) {\n        [...component.$element.querySelectorAll('[ref]')].forEach(e => {\n            component.refs[e.getAttribute('ref')] = e;\n        });\n        [...component.$element.querySelectorAll('[-x-onclick]')].forEach(e => {\n            const ev2 = eval;\n            const _this_component = component;\n            const fn = e.getAttribute('-x-onclick').replace('this.', '_this_component.');\n            e.onclick = () => ev2(fn);\n        });        \n        //traverse all elements that contain {{\n        \n        if (component.data) {\n            if (typeof component.data == \"function\") {\n                component.data = component.data();\n            }\n            component._data = {};\n            for (const key in component.data) {\n                component._data[key] = Signal(component.data[key]);\n                if (Array.isArray(component.data[key])) {\n                    console.log(\"here we go\", key)\n                    for (let i = 0; i < component.data[key].length; i++) {\n                        component._data[key].value[i] = Signal(component.data[key][i]);\n                    }\n                }\n            }\n        }\n        //traverse x-model\n        [...component.$element.querySelectorAll('[x-model]')].forEach(e => {\n            const key = e.getAttribute('x-model');\n            if (component._data && component._data[key]) {\n                e.value = component._data[key].value;\n                e.oninput = () => {\n                    component._data[key].value = e.value;\n                }\n                effect(() => {\n                    e.value = component._data[key].value;\n                });\n                \n            }           \n        });             \n        //const textNodes = component.$element.querySelectorAll('*:not([x-for] *)');\n        //get all textnodes not child of a node with x-for attribute\n        const textNodes = component.$element.querySelectorAll('*:not([x-for])');\n        for (const node of textNodes) {\n            for (const child of node.childNodes) {\n                if (child.nodeType === 3) {\n                    if (child.textContent.includes('{{')) {\n                        const [textArr, reactiveIndexes] = prepareForReplace(child.textContent);\n                        effect(() => {                           \n                            replace(component, child, textArr, reactiveIndexes);\n                        });\n                    }\n                }\n            }\n        }\n        //add x-for\n        [...component.$element.querySelectorAll('[x-for]')].forEach(e => {\n            //x-for=\"item in items\"\n            const parts = e.getAttribute('x-for').split(' in ');\n            const key = parts[1];\n            const itemkey = parts[0];\n            const [textArr, reactiveIndexes] = prepareForReplace(e.textContent);\n            console.log('>>>>key', key);\n            const parent = e.parentElement;\n            //remove all nodes from parent\n            effect(() => {\n                while (parent.firstChild) {\n                    parent.removeChild(parent.firstChild);\n                }\n                if (component._data && component._data[key]) {\n                    const data = component._data[key].value;\n                    for (const d of data) {\n                        const clone = e.cloneNode(true);\n                        clone.removeAttribute('x-for');\n                        console.log('>>>>clone', clone.textContent);\n                        replace(component, clone, textArr, reactiveIndexes, { [itemkey]: d });\n                        parent.appendChild(clone);\n                    }\n                }\n            });\n        });\n    }    \n    if (component.style && !styleTagsAdded.includes(component.compId)) {\n        let style = component.style;\n        if (typeof style == \"function\") {           \n            style = style();\n        }\n        const styleTag = document.createElement('style');\n        styleTag.innerHTML = style;\n        document.head.appendChild(styleTag);\n        if (component.compId) {\n            styleTagsAdded.push(component.compId);\n        }\n\n    }\n    if (component.init) {\n        component.init();\n    }\n    return component;\n}"],
  "mappings": "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",
  "names": ["current", "createSignal", "initialValue", "value", "subscribers", "refresh", "sub", "set", "newValue", "read", "effect", "fn", "SignalObject", "_SignalObject", "Signal", "html", "markup", "tp", "styleTagsAdded", "bubblify", "str", "prepareForReplace", "txt", "textArr", "reactiveIndexes", "i", "parts", "replace", "component", "child", "moreData", "newText", "data", "key", "createComponent", "original", "parent", "e", "ev2", "_this_component", "fn", "Signal", "effect", "textNodes", "node", "itemkey", "d", "clone", "style", "styleTag"]
}
