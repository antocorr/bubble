{
  "version": 3,
  "sources": ["../src/lib/Signals.js", "../src/lib/Reactivity.js"],
  "sourcesContent": ["let current;\n/**\n * \n * @param {*} initialValue \n * @returns {[function(): *, function(*): void, function(): void]}\n */\nexport function createSignal(initialValue) {\n    let value = initialValue;\n    const\n        subscribers = [];\n    function refresh() {\n        subscribers.forEach(sub => sub())\n    }\n    function\n        set(newValue) {\n        value = newValue;\n        refresh();\n    }\n    function get() {\n        if (current) {            \n            subscribers.push(current)\n        }\n        return value;\n    }\n    return [get, set, refresh]\n}\nexport function effect(fn) {\n    current = fn;\n    fn();\n    current = null;\n}\nclass SignalObject{\n    get;\n    set;\n    refresh;\n    constructor(value){\n        const [get, set, refresh] = createSignal(value);\n        this.get = get;\n        this.set = set;\n        this.refresh = refresh;\n    }\n    get value(){\n        return this.get();\n    }\n    set value(newValue){\n        this.set(newValue);\n    }\n    push(newValue){\n        this.value.push(new SignalObject(newValue));\n        this.refresh();\n    }\n}\nexport function Signal(value){\n    return new SignalObject(value);\n}", "import { effect, Signal } from \"./Signals.js\";\n/**\n * \n * @param {string} markup \n * @returns {HTMLElement}\n */\nexport function html(markup) {\n    const tp = document.createElement('template');\n    tp.innerHTML = markup.trim();\n    return tp.content.firstElementChild;\n}\nconst styleTagsAdded = [];\nfunction bubblify(str) {\n    //replace all @click with -bb-onclick\n    str = str.replace(/@click/g, '-x-onclick');\n    return str;\n}\nfunction prepareForReplace(txt) {\n    /**\n     * @type {string[]}\n     */\n    const textArr = txt.split('{{');\n    const reactiveIndexes = [];\n    for (let i = 0; i < textArr.length; i++) {\n        if (textArr[i].includes('}}')) {\n            const parts = textArr[i].split('}}');\n            textArr[i] = parts[0];\n            //add second part to the array\n            textArr.splice(i + 1, 0, parts[1]);\n            reactiveIndexes.push(i);\n        }\n    }\n    return [textArr, reactiveIndexes];\n}\n/**\n * \n * @param {{}} component \n * @param {HTMLElement} child \n * @param {string[]} textArr \n * @param {number[]} reactiveIndexes \n */\nfunction replace(component, child, textArr, reactiveIndexes, moreData = {}) {\n    let newText = '';\n    const data = { ...component._data, ...moreData };\n    if (Object.keys(moreData).length) {\n        // console.log('moreData', moreData);\n    }\n    for (let i = 0; i < textArr.length; i++) {        \n        if (reactiveIndexes.includes(i)) {\n            const key = textArr[i];\n            if (data && data[key]) {\n                newText += data[key].value;\n            } else {\n                console.error(`Key ${key} not found in data`);\n            }\n        } else {\n            newText += textArr[i];\n        }\n    }\n    child.textContent = newText;\n}\n/**\n * \n * @param {{}} original \n * @param {{} | undefined} data \n * @returns {{\n * $element: HTMLElement,\n * appendTo: (parent: HTMLElement) => void,\n * refs: {Object.<string, HTMLElement>},\n * _data: {Object.<string, SignalObject>},\n * }}\n */\nexport function createComponent(original, data) {\n    let props = {};\n    if (data && data.props) {\n        props = data.props;\n        if (typeof props == \"function\") {\n            props = props();\n        }\n        delete data.props;\n    }\n    const component = {\n        $element: null,\n        appendTo: (parent) => {\n            if (component.$element) {\n                parent.appendChild(component.$element);\n                if(component.mounted){\n                    component.mounted();\n                }\n            }\n        },\n        refs: {}, ...original, ...data\n    };\n    let tp = component.setTemplate ? component.setTemplate : component.template;\n    if (typeof tp == \"function\") {\n        tp = tp();\n    }\n    if (tp) {\n        component.$element = html(bubblify(tp));\n    }\n    if (component.$element) {\n        [...component.$element.querySelectorAll('[ref]')].forEach(e => {\n            component.refs[e.getAttribute('ref')] = e;\n        });\n        [...component.$element.querySelectorAll('[-x-onclick]')].forEach(e => {\n            const _this_component = component;\n            const fn = e.getAttribute('-x-onclick').replace('this.', '_this_component.');\n            e.onclick = () => eval(fn);\n        });        \n        //traverse all elements that contain {{\n        \n        if (component.data) {\n            if (typeof component.data == \"function\") {\n                component.data = component.data();\n            }\n            component._data = {};\n            const data = { ...component.data, ...props };\n            for (const key in data) {\n                component._data[key] = Signal(data[key]);\n                if (Array.isArray(data[key])) {\n                    for (let i = 0; i < data[key].length; i++) {\n                        component._data[key].value[i] = Signal(data[key][i]);\n                    }\n                }\n            }\n        }\n        //traverse x-model\n        [...component.$element.querySelectorAll('[x-model]')].forEach(e => {\n            const key = e.getAttribute('x-model');\n            if (component._data && component._data[key]) {\n                e.value = component._data[key].value;\n                e.oninput = () => {\n                    component._data[key].value = e.value;\n                }\n                effect(() => {\n                    e.value = component._data[key].value;\n                });\n                \n            }           \n        });             \n        //const textNodes = component.$element.querySelectorAll('*:not([x-for] *)');\n        //get all textnodes not child of a node with x-for attribute\n        const textNodes = component.$element.querySelectorAll('*:not([x-for])');\n        for (const node of textNodes) {\n            for (const child of node.childNodes) {\n                if (child.nodeType === 3) {\n                    if (child.textContent.includes('{{')) {\n                        const [textArr, reactiveIndexes] = prepareForReplace(child.textContent);\n                        effect(() => {                           \n                            replace(component, child, textArr, reactiveIndexes);\n                        });\n                    }\n                }\n            }\n        }\n        //add x-for\n        [...component.$element.querySelectorAll('[x-for]')].forEach(e => {\n            //x-for=\"item in items\"\n            const parts = e.getAttribute('x-for').split(' in ');\n            const key = parts[1];\n            const itemkey = parts[0];\n            const [textArr, reactiveIndexes] = prepareForReplace(e.textContent);\n            const parent = e.parentElement;\n            //remove all nodes from parent\n            effect(() => {\n                while (parent.firstChild) {\n                    parent.removeChild(parent.firstChild);\n                }\n                if (component._data && component._data[key]) {\n                    const data = component._data[key].value;\n                    for (const d of data) {\n                        const clone = e.cloneNode(true);\n                        clone.removeAttribute('x-for');\n                        replace(component, clone, textArr, reactiveIndexes, { [itemkey]: d });\n                        parent.appendChild(clone);\n                    }\n                }\n            });\n        });\n    }    \n    if (component.style && !styleTagsAdded.includes(component.compId)) {\n        let style = component.style;\n        if (typeof style == \"function\") {           \n            style = style();\n        }\n        const styleTag = document.createElement('style');\n        styleTag.innerHTML = style;\n        document.head.appendChild(styleTag);\n        if (component.compId) {\n            styleTagsAdded.push(component.compId);\n        }\n\n    }\n    if (component.init) {\n        component.init();\n    }\n    return component;\n}"],
  "mappings": "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",
  "names": ["current", "createSignal", "initialValue", "value", "subscribers", "refresh", "sub", "set", "newValue", "get", "effect", "fn", "SignalObject", "_SignalObject", "Signal", "html", "markup", "tp", "styleTagsAdded", "bubblify", "str", "prepareForReplace", "txt", "textArr", "reactiveIndexes", "i", "parts", "replace", "component", "child", "moreData", "newText", "data", "key", "createComponent", "parent", "e", "Signal", "effect", "node", "itemkey", "d", "clone", "style", "styleTag"]
}
