var d;function C(l){let o=l,e=[];function r(){e.forEach(n=>n())}function c(n){o=n,r()}function t(){return d&&e.push(d),o}return[t,c,r]}function u(l){d=l,l(),d=null}var p=class l{read;set;refresh;constructor(o){let[e,r,c]=C(o);this.read=e,this.set=r,this.refresh=c}get value(){return this.read()}set value(o){this.set(o)}push(o){this.value.push(new l(o)),this.refresh()}};function h(l){return new p(l)}function k(l){let o=document.createElement("template");return o.innerHTML=l.trim(),o.content.firstElementChild}var m=[];function $(l){return l=l.replace(/@click/g,"-x-onclick"),l}function x(l){let o=l.split("{{"),e=[];for(let r=0;r<o.length;r++)if(o[r].includes("}}")){let c=o[r].split("}}");o[r]=c[0],o.splice(r+1,0,c[1]),e.push(r)}return console.log(o,e),[o,e]}function y(l,o,e,r,c={}){let t="",n={...l._data,...c};Object.keys(c).length&&console.log("moreData",c);for(let a=0;a<e.length;a++)if(r.includes(a)){let i=e[a];n&&n[i]?t+=n[i].value:console.error(`Key ${i} not found in data`)}else t+=e[a];o.textContent=t}function b(l,o){let e={$element:null,appendTo:c=>{e.$element&&(c.appendChild(e.$element),e.mounted&&e.mounted())},refs:{},...l,...o},r=e.setTemplate?e.setTemplate:e.template;if(typeof r=="function"&&(r=r()),r&&(e.$element=k($(r))),e.$element){if([...e.$element.querySelectorAll("[ref]")].forEach(t=>{e.refs[t.getAttribute("ref")]=t}),[...e.$element.querySelectorAll("[-x-onclick]")].forEach(t=>{let n=eval,a=e,i=t.getAttribute("-x-onclick").replace("this.","_this_component.");t.onclick=()=>n(i)}),e.data){typeof e.data=="function"&&(e.data=e.data()),e._data={};for(let t in e.data)if(e._data[t]=h(e.data[t]),Array.isArray(e.data[t])){console.log("here we go",t);for(let n=0;n<e.data[t].length;n++)e._data[t].value[n]=h(e.data[t][n])}}[...e.$element.querySelectorAll("[x-model]")].forEach(t=>{let n=t.getAttribute("x-model");e._data&&e._data[n]&&(t.value=e._data[n].value,t.oninput=()=>{e._data[n].value=t.value},u(()=>{t.value=e._data[n].value}))});let c=e.$element.querySelectorAll("*:not([x-for])");for(let t of c)for(let n of t.childNodes)if(n.nodeType===3&&n.textContent.includes("{{")){let[a,i]=x(n.textContent);u(()=>{y(e,n,a,i)})}[...e.$element.querySelectorAll("[x-for]")].forEach(t=>{let n=t.getAttribute("x-for").split(" in "),a=n[1],i=n[0],[g,v]=x(t.textContent);console.log(">>>>key",a);let s=t.parentElement;u(()=>{for(;s.firstChild;)s.removeChild(s.firstChild);if(e._data&&e._data[a]){let _=e._data[a].value;for(let A of _){let f=t.cloneNode(!0);f.removeAttribute("x-for"),console.log(">>>>clone",f.textContent),y(e,f,g,v,{[i]:A}),s.appendChild(f)}}})})}if(e.style&&!m.includes(e.compId)){let c=e.style;typeof c=="function"&&(c=c());let t=document.createElement("style");t.innerHTML=c,document.head.appendChild(t),e.compId&&m.push(e.compId)}return e.init&&e.init(),e}export{b as createComponent};
//# sourceMappingURL=bubble.js.map
